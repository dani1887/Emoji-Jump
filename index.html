<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Emoji Jumper</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background-color: #333;
    font-family: sans-serif;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: start;
    transition: background 0.5s ease;
  }
  #score { margin-top: 10px; color: #fff; font-size: 24px; font-weight: bold; z-index: 10; }
  #time { margin-top: 5px; color: #fff; font-size: 18px; font-weight: bold; z-index: 10; }
  #superJumpContainer { width: 300px; height: 20px; background: #555; margin-top: 8px; border-radius: 10px; overflow: hidden; position: relative; display: none; }
  #superJumpBar { height: 100%; background: #00e676; width: 0%; transition: width 0.1s linear; }
  #superJumpText { position: absolute; width: 100%; text-align: center; top: 0; left: 0; color: white; font-size: 14px; font-weight: bold; pointer-events: none; }
  canvas { background: #333; margin-top: 10px; border-radius: 8px; transition: background 0.5s ease; }
  #recordsBtn, #updateLogBtn { position: absolute; top: 10px; padding: 5px 10px; font-size: 14px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; }
  #recordsBtn { left: 10px; }
  #updateLogBtn { left: 120px; }
  #playerName { position: absolute; top: 50px; left: 10px; padding: 4px; font-size: 14px; border-radius: 6px; border: none; }
  #recordsPanel, #updateLogPanel { position: absolute; top: 90px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 8px; width: 220px; max-height: 300px; overflow-y: auto; display: none; }
  #gameOverPanel { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: white; padding: 20px; border-radius: 10px; display: none; text-align: center; }
  #gameOverPanel button { margin-top: 10px; padding: 5px 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>
<button id="recordsBtn">Records</button>
<button id="updateLogBtn">Update Log</button>
<input type="text" id="playerName" placeholder="Seu nome" maxlength="12" />

<div id="recordsPanel">
  <h3>Top 10 Records</h3>
  <ol id="recordsList"></ol>
</div>

<div id="updateLogPanel">
  <h3>Update 1</h3>
  <ul>
    <li>Bug de Spawn corrigido</li>
    <li>Nova Plataforma amarela (nos 10.000 pontos fica mais r√°pida)</li>
    <li>Novo menu de Game Over</li>
    <li>Nova tabela de UpdateLog</li>
  </ul>
</div>

<div id="gameOverPanel">
  <h2>Voc√™ perdeu!</h2>
  <p id="finalScore">Pontua√ß√£o: 0</p>
  <p id="finalTime">Tempo: 0:00</p>
  <button id="restartBtn">Recome√ßar</button>
</div>

<div id="score">Pontua√ß√£o: 0</div>
<div id="time">Tempo: 0s</div>

<div id="superJumpContainer">
  <div id="superJumpBar"></div>
  <div id="superJumpText"></div>
</div>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const emojis = ["üßç", "ü¶ä", "ü§ñ", "üëª", "üê±", "üê∑", "üêô", "üêµ"];
const bgColors = ["#333", "#004466", "#2E003E", "#3E4E50", "#222900", "#1A3C2E", "#512E5F", "#5D3A00"];

let currentEmojiIndex = 0;

const player = { x: 0, y: 0, width: 40, height: 40, dy: 0, dx: 0, emoji: emojis[currentEmojiIndex] };

const gravity = 0.5, jumpStrength = -12, superJumpStrength = -22, moveSpeed = 4;
let platforms = [], keys = {}, score = 0;

// Super pulo
let superJumpUnlocked = false, superJumpCharge = 0;
const maxSuperJumpCharge = 100, chargeRate = 0.2;
const superJumpBar = document.getElementById("superJumpBar");
const superJumpText = document.getElementById("superJumpText");
const superJumpContainer = document.getElementById("superJumpContainer");

// Bola m√°gica
let magicBall = null;

// Tempo
let startTime = 0, elapsedTime = 0;

// DeltaTime
let lastTime = Date.now();

// Records
let records = JSON.parse(localStorage.getItem("records")) || [];

function saveRecord(name, score, time) {
  records.push({ name, score, time });
  records.sort((a, b) => b.score !== a.score ? b.score - a.score : a.time - b.time);
  records = records.slice(0, 10);
  localStorage.setItem("records", JSON.stringify(records));
}

function showRecords() {
  const list = document.getElementById("recordsList");
  list.innerHTML = "";
  records.forEach(r => {
    const minutes = Math.floor(r.time / 60);
    const seconds = r.time % 60;
    const timeStr = `${minutes}:${seconds.toString().padStart(2,"0")}s`;
    const li = document.createElement("li");
    li.textContent = `${r.name} - ${r.score} pts - ${timeStr}`;
    list.appendChild(li);
  });
}

document.getElementById("recordsBtn").addEventListener("click", () => {
  const panel = document.getElementById("recordsPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
  showRecords();
});

document.getElementById("updateLogBtn").addEventListener("click", () => {
  const panel = document.getElementById("updateLogPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
});

// Game Over
const gameOverPanel = document.getElementById("gameOverPanel");
document.getElementById("restartBtn").addEventListener("click", () => {
  gameOverPanel.style.display = "none";
  resetGame();
});

let isGameOver = false;

function createPlatform(x, y, width=100, height=10, type="normal") {
  return { x, y, width, height, type, dir: 1, speed: 1 };
}

function spawnMagicBall() {
  const platform = createPlatform(Math.random() * 250, player.y - 300);
  platforms.push(platform);
  magicBall = { x: platform.x + 35, y: platform.y - 20, radius: 10, collected: false };
}

function resetGame() {
  isGameOver = false;

  platforms = [];
  const firstPlat = createPlatform(180, 550);
  platforms.push(firstPlat);

  player.x = firstPlat.x + firstPlat.width/2 - player.width/2;
  player.y = firstPlat.y - player.height;

  player.dy = 0; score = 0;
  superJumpCharge = 0; superJumpUnlocked = false;
  magicBall = null; currentEmojiIndex = 0;
  player.emoji = emojis[currentEmojiIndex];

  superJumpBar.style.width = "0%";
  superJumpContainer.style.display = "none";

  document.body.style.backgroundColor = bgColors[currentEmojiIndex];
  canvas.style.backgroundColor = bgColors[currentEmojiIndex];

  for (let i=1; i<4; i++) {
    platforms.push(createPlatform(Math.random()*300, 550 - i*140));
  }

  startTime = Date.now();
  lastTime = Date.now();
}

function update(deltaTime) {
  const dt = deltaTime / 16.6667; // Normaliza para 60FPS

  // Movimento horizontal
  if (keys["arrowleft"]||keys["a"]) player.dx=-moveSpeed*dt;
  else if (keys["arrowright"]||keys["d"]) player.dx=moveSpeed*dt;
  else player.dx=0;

  player.x += player.dx;

  if(player.x<-player.width) player.x=canvas.width;
  if(player.x>canvas.width) player.x=-player.width;

  // Gravidade
  player.dy += gravity*dt;
  player.y += player.dy*dt;

  // Plataformas
  for(let plat of platforms){
    if(plat.type==="moving"){
      let speed = plat.speed*dt;
      if(score>=10000) speed*=2.5;
      plat.x += plat.dir*speed;
      if(plat.x<0 || plat.x+plat.width>canvas.width) plat.dir*=-1;
    }

    if(player.dy>0 && player.x<plat.x+plat.width && player.x+player.width>plat.x &&
       player.y+player.height<plat.y+10 && player.y+player.height+player.dy>=plat.y){
      player.dy = jumpStrength;
    }
  }

  // Super salto
  if(superJumpUnlocked && (keys["s"]||keys["arrowdown"]) && superJumpCharge>=maxSuperJumpCharge){
    player.dy = superJumpStrength;
    superJumpCharge = 0;
  }

  if(player.y<300){
    const diff = 300-player.y;
    player.y=300;
    platforms.forEach(p=>p.y+=diff);
    if(magicBall) magicBall.y+=diff;
    score+=Math.floor(diff);

    let newEmojiIndex = Math.floor(score/1000)%emojis.length;
    if(newEmojiIndex!==currentEmojiIndex){
      currentEmojiIndex=newEmojiIndex;
      player.emoji=emojis[currentEmojiIndex];
      document.body.style.backgroundColor = bgColors[currentEmojiIndex];
      canvas.style.backgroundColor = bgColors[currentEmojiIndex];
    }

    if(score>=1000 && !magicBall && !superJumpUnlocked) spawnMagicBall();
  }

  while(platforms[platforms.length-1].y>0){
    const type = Math.random()<0.2 ? "moving" : "normal";
    platforms.push(createPlatform(Math.random()*300, platforms[platforms.length-1].y-140, 100, 10, type));
  }

  platforms = platforms.filter(p=>p.y<canvas.height+100);

  // Game Over
  if(player.y>canvas.height && !isGameOver){
    const name = document.getElementById("playerName").value||"???";
    saveRecord(name, score, elapsedTime);
    isGameOver = true;
    gameOverPanel.style.display = "block";
    document.getElementById("finalScore").innerText = "Pontua√ß√£o: "+score;
    document.getElementById("finalTime").innerText = "Tempo: "+Math.floor(elapsedTime/60)+":"+String(elapsedTime%60).padStart(2,"0");
  }

  // Bola m√°gica
  if(magicBall && !magicBall.collected){
    const dx = (player.x+player.width/2)-magicBall.x;
    const dy = (player.y+player.height/2)-magicBall.y;
    if(Math.sqrt(dx*dx+dy*dy)<magicBall.radius+player.width/2){
      magicBall.collected=true; magicBall=null;
      superJumpUnlocked=true; superJumpContainer.style.display="block";
    }
  }

  if(superJumpUnlocked && superJumpCharge<maxSuperJumpCharge){
    superJumpCharge += chargeRate*dt;
  }

  if(superJumpUnlocked){
    superJumpBar.style.width = (superJumpCharge/maxSuperJumpCharge*100)+"%";
    superJumpText.textContent = superJumpCharge>=maxSuperJumpCharge?"Pressione S para SUPER SALTO!":"";  
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let plat of platforms){
    ctx.fillStyle=plat.type==="moving"?"#FFD700":"#4caf50";
    ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
  }

  if(magicBall && !magicBall.collected){
    ctx.beginPath();
    ctx.arc(magicBall.x, magicBall.y, magicBall.radius,0,Math.PI*2);
    ctx.fillStyle="#FFD700";
    ctx.fill();
    ctx.closePath();
  }

  ctx.font="30px serif"; ctx.textAlign="center";
  ctx.fillText(player.emoji, player.x+player.width/2, player.y+player.height);

  document.getElementById("score").innerText="Pontua√ß√£o: "+score;

  elapsedTime=Math.floor((Date.now()-startTime)/1000);
  const minutes=Math.floor(elapsedTime/60);
  const seconds=elapsedTime%60;
  document.getElementById("time").innerText="Tempo: "+minutes+":"+String(seconds).padStart(2,"0");
}

function gameLoop(){
  const now = Date.now();
  const deltaTime = now - lastTime;
  lastTime = now;

  update(deltaTime);
  draw();
  requestAnimationFrame(gameLoop);
}

document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

resetGame();
gameLoop();
</script>
</body>
</html>
